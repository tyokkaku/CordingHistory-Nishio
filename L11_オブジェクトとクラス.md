# 第11章　オブジェクトとクラス

## 11.1　オブジェクト指向とは何か

### 言語によって違う「オブジェクト指向」の意味

そもそもオブジェクト指向言語の設計者によっても、その意味が異なる。

- SmallTalk:型や継承に否定的であり、メッセージの送受信に重きを置いたオブジェクト指向
- C++：型や継承を肯定したオブジェクト指向

### オブジェクトは現実世界の模型

意味は異なるが、目的は、楽に「モノ(Object)を使って現実世界の模型(model)」を作ること。プログラミング的に言えば、「変数や関数を束ねてそれを「モノ」として、モノを組み合わせて現実世界の模型をつくる」ということ。

### クラスとは

## 11.2　変数と関数を束ねて模型を作る方法

1. モジュールorパッケージ
2. ハッシュ
3. クロージャ
4. クラス

## 11.3　方法1　モジュール，パッケージ

### モジュール，パッケージとは何か

関連性の強い関数や変数のまとまりを明示するためにモジュール/パッケージという概念が導入された。Perlでは、パッケージを用いてオブジェクト指向を実現している。

```perl
{
  /* パッケージに値とモノとする */
  package Counter;
  /* newを用いてコンストラクタを作る(複数のインスタンスを作るときに省略できる) */ 
  sub new{
    return { "value" => 0};
  }
  /* メソッドを持たせる */
  sub push{
    my $values = shift;
    $values->{count}++;
    print "$values->{count}匹\n";
  }
}

{
  /* データ置き場は個別にするために、カウントの保存場所をハッシュでちらす */
  # ハッシュとパッケージを結びつける
  bless $counter, "Counter";
  print "$counter\n";

  /* blessされた変数は、省略して書ける */
  $counter->push; #=> 1匹
  $counter->push; #=> 2匹
}
```

## 11.4　方法2　関数もハッシュに入れる

JavaScriptは、「関数もハッシュに入れる」という方法を採用した。

### ファーストクラス

ファーストクラスとは、以下を満たしたもののことである。JavaScriptにおいて、関数はファーストクラスである。

- 変数に代入できる
- 関数の引数として渡すことができる
- 関数の戻り値として返すことができる

### 関数をハッシュに入れる

```js
function makeCounter(){
var counter = {
  count: 0,
  name: "スズメ",

  push: function(){
    this.count++;
    console.log(this.name + ": " + this.count + "匹");
  },
  reset: function(){
    this.count = 0;
    console.log(this.name + ": " + "リセット");
  }
}
}

counter.push(); // スズメ1匹
counter.push(); // スズメ2匹
counter.push(); // スズメ3匹
counter.reset();  // スズメ0匹
counter.push(); // スズメ1匹
```

### 共有してよいモノをプロトタイプに移す

counterが作られるたびに、関数pushが生成されてしまう問題がある。JavaScriptでは、プロトタイプを使って、共有部分を定義できる。

あるオブジェクトになくても、プロトタイプにあれば、そのオブジェクトは、プロトタイプから情報を得て答えることができる。

```js
obj = {}
obj.__proto__ = {x: 1}

console.log(obj); // {}
console.log(obj.__proto__); // {x: 1}
console.log(obj.x); // {1}
```

さらに、new演算子を使えば、プロトタイプの利用を楽にできる。

## 11.5　方法3　クロージャ

### クロージャとは

makeCounterのcountは束縛している。countと0が束縛されているので、pushのcountは、巻き上げをそこまでで中止する。

- 外側の関数の戻り値として、内側の関数が定義されている
- 静的スコープがネストできる

```js
function makeCounter(){
  var count = 0;
  function push(){
    count++;
    console.log(count);
  }
  return push;
}

// 呼び出すごとに初期化されそうなものの、期待通りにカウントアップされている
c = makeCounter();
c(); // 1
c(); // 2
c(); // 3
```

## 11.6　方法4　クラス

クラス
- 分類 : 一般的な考え方
- ユーザが定義できる型の宣言 : C++,Java
- メッセージをやりとりするもの : smallTalk
- まとまったものを作る生成機 : JavaScriptやPerl

C++とsmallTalkの違いは、存在しないメソッドの呼び出し時の違い

C++ : コンパイルエラー(C++において、クラスは、ユーザーが定義できる型であり仕様の「宣言」のこと)
SmallTalk : 受け手のオブジェクトの実装次第(SmallTalkにおいて、メッセージを送り合うもの)

### 11.7　まとめ