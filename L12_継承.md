# 第12章　継承によるコードの再利用

## 12.1　継承とは

### 継承に対するさまざまな考え方

- 一般化/特殊化： 子クラスは親クラスを特殊化したもの。親クラスは、子クラスの一般的な形という考え方。親子関係がある。Java的な。
- 共通部分の抽出： 共通部分を抽出しておいて、継承するクラスがそれを使うという考え方。親子関係では捉えない。プロトタイプ的な。
- 差分実装： 継承を再利用のために使うという考え方。親子関係では捉えない。モジュール/トレイト的な。

### 継承は諸刃の剣

継承関係のネストが深くなりすぎると、人間にはその影響範囲を追えなくなる。

リスコフの置換原則は、これを限定するために考えられた法則。子クラスの属性は、親クラスの属性の範囲を超えてはならない。したがって、子クラスになっていくにつれて、属性の範囲は同等か小さくなり、大きくはならない。

## 12.2　多重継承

### 実装の再利用に便利な多重継承

多重継承ができると、複数のクラスを合成した新しいクラスを作ることができる。しかし、名前衝突の問題がある。

### 解決策1　多重継承を禁止する

名前衝突が起きないように、そもそも多重継承を禁止した(Java)。しかし、不便であるため、委譲で対応したり、インタフェースを実装している。

### 委譲

```java
public class TestDelegate {
  public static void main(String[] args) {
    new UseInheritance().useHello(); // -> hello!
    new UseDelegate().useHello(); // -> hello!
  }
}

class Hello {
  public void hello() {
    System.out.println("hello!");
  }
}

// 継承
class UseInheritance extends Hello {
  public void useHello(){
    hello();
  }
}

// 委譲
// Hello型の変数hで、オブジェクトを生成。UseDelegateのuseHelloメソッドは、生成したHello型のオブジェクトのメソッドを使っている。
class UseDelegate {
  Hello h = new Hello();
  public void useHello(){
    h.hello();
  }
}
```

### インタフェース

多重継承による名前衝突の対策として、Javaにはインタフェースが導入された。

- インタフェースは実装を持たない。
- またインタフェースを継承する際は、かならず定義されたメソッドを実装しなくてはならない。

インタフェースは実装を持っていないので、名前衝突しない。インタフェースは複数実装できる。継承関係にないクラスが、自由にインタフェースの実装を使うことができる。(多重継承しなくても)

### 解決策2　メソッド解決順序を工夫する

多重継承による名前衝突の対策として、継承関係を遡る順序を明確に決めておく、という発想もある。ルールがあれば、コンピュータが衝突した際に、どちらを優先するか判断できる。

- 深さ優先探索 : 子よりも親が優先されるケースがある
- 線形化 : 子が優先される。複数の親クラスがある場合は、先に書かれたものが優先される。

線形化

- 親クラスは子クラスより先に探索されない
- あるクラスが複数の親クラスを継承している場合は先に書いてあるものが優先される

### 解決策3　処理を混ぜ込む（Mix-in）

そもそも継承関係を遡らないでもいいようにする、という発想がmix-in。再利用したい機能だけを持った小さなクラスを作って、それだけをトッピングのように混ぜればいい、という発想がmix-in。

Mix-inを用いても、複数のmixinで同じ名前のメソッドがあれば名前衝突する。過剰なMix-inは、人間では影響範囲が追えないのではないか。

### 解決策4　トレイト

設計思想

- クラスの役割
  - 再利用の単位
  - インスタンス生成機

上記の二つが相反するものであるため、クラスから「再利用の単位」の役割を排除して、「トレイト」という小さな構造体を新たに作ればいいという発想だった。(モジュールと考えは同じ)

トレイトの特徴

- 基本的にmix-inと同じ発想だが、mix-inで衝突が起きた場合に上書きされていたところを、明示的にエラーが出るようになった。
- さらに、インスタンス生成する際に、「要求するメソッド」と「提供するメソッド」を区別し、両者が正しく組み合わさっているかを判断するようにした。